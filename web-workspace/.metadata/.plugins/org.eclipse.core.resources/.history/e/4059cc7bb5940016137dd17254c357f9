<?php
require_once __DIR__.'\..\Persistence\PresistenceFoodTruck.php';
require_once __DIR__.'\..\Model\MenuItem.php';
require_once __DIR__.'\..\Model\FoodTruckManager.php';

class ControllerTest extends PHPUnit_Framework_TestCase
{
    protected $c;
    protected $pft;
    protected $ftm;

    protected function setUp()
    {
        $this->c = new Controller();
        $this->pft = new PersistenceFoodTruck();
        $this->ftm = $this->pft->loadDataFromStore();
        $this->ftm->delete();
        $this->pft->writeDataToStore($this->ftm);
    }

    protected function tearDown()
    {
    }

    public function testCreateParticipant() {
        $this->assertEquals(0, count($this->ftm->getMenuItems()));
    
    	$name = "Burger";
    	$price= 10.0;
    	try {
    		$this->c->createMenuItem($name,$price);
    	} catch (Exception $e) {
    		// check that no error occurred
    		$this->fail();
    	}
    
    	// check file contents
    	$this->ftm = $this->pft->loadDataFromStore();
    	$this->assertEquals(1, count($this->ftm->getMenuItems()));
    	$this->assertEquals($name, $this->ftm->getMenuItem_index(0)->getName());
    	$this->assertEquals(0, count($this->rm->getEvents()));
    	$this->assertEquals(0, count($this->rm->getRegistrations()));
    }
    
    public function testCreateParticipantNull() {
        $this->assertEquals(0, count($this->rm->getParticipants()));
    
    	$name = null;
    
    	$error = "";
    	try {
    		$this->c->createParticipant($name);
    	} catch (Exception $e) {
			$error = $e->getMessage();
    	}
    
    	// check error
    	$this->assertEquals("Participant name cannot be empty!", $error);
        // check file contents
    	$this->rm = $this->pm->loadDataFromStore();
    	$this->assertEquals(0, count($this->rm->getParticipants()));
    	$this->assertEquals(0, count($this->rm->getEvents()));
    	$this->assertEquals(0, count($this->rm->getRegistrations()));
    }
    
    public function testCreateParticipantEmpty() {
    	$this->assertEquals(0, count($this->rm->getParticipants()));
    
    	$name = "";
    
    	$error = "";
    	try {
    		$this->c->createParticipant($name);
    	} catch (Exception $e) {
    		$error = $e->getMessage();
    	}
    
    	// check error
    	$this->assertEquals("Participant name cannot be empty!", $error);
    	// check file contents
    	$this->rm = $this->pm->loadDataFromStore();
    	$this->assertEquals(0, count($this->rm->getParticipants()));
    	$this->assertEquals(0, count($this->rm->getEvents()));
    	$this->assertEquals(0, count($this->rm->getRegistrations()));
    }
    
    public function testCreateParticipantSpaces() {
    	$this->assertEquals(0, count($this->rm->getParticipants()));
    
    	$name = " ";
    
    	$error = "";
    	try {
    		$this->c->createParticipant($name);
    	} catch (Exception $e) {
    		$error = $e->getMessage();
    	}
    
    	// check error
    	$this->assertEquals("Participant name cannot be empty!", $error);
    	// check file contents
    	$this->rm = $this->pm->loadDataFromStore();
    	$this->assertEquals(0, count($this->rm->getParticipants()));
    	$this->assertEquals(0, count($this->rm->getEvents()));
    	$this->assertEquals(0, count($this->rm->getRegistrations()));
    }
}
?>